#!/bin/bash

# Epic to Feature Issues Generator Script
# Usage: ./create-features.sh <epic_number> <epic_title>

set -e

EPIC_NUMBER=$1
EPIC_TITLE=$2

if [ -z "$EPIC_NUMBER" ] || [ -z "$GITHUB_TOKEN" ]; then
    echo "Error: EPIC_NUMBER and GITHUB_TOKEN are required"
    exit 1
fi

echo "ğŸš€ Creating Feature Issues from Epic #$EPIC_NUMBER..."

# Epic #2: CI/CDç’°å¢ƒã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ•´å‚™
if [ "$EPIC_NUMBER" = "2" ]; then
    echo "ğŸ“‹ Creating CI/CD Epic Features..."
    
    # CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š
    ISSUE1=$(gh issue create \
        --title "[FEAT] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š" \
        --assignee "@me" \
        --body-file <(cat << 'EOF'
## ğŸ¯ èƒŒæ™¯ãƒ»ç›®çš„
RAGã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®ãŸã‚ã®GitHub Actions CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è¨­å®šã—ã€è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ»å“è³ªãƒã‚§ãƒƒã‚¯ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

## ğŸ“‹ è¦ä»¶
### æ©Ÿèƒ½è¦ä»¶
- [ ] GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š (.github/workflows/ci.yml)
- [ ] Python 3.11ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] è¤‡æ•°ã‚¸ãƒ§ãƒ–ã§ã®ä¸¦åˆ—å‡¦ç† (test, security, quality)
- [ ] ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã®è‡ªå‹•å®Ÿè¡Œ
- [ ] ãƒ†ã‚¹ãƒˆçµæœã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ã®å¯è¦–åŒ–

### éæ©Ÿèƒ½è¦ä»¶
- [ ] å®Ÿè¡Œæ™‚é–“5åˆ†ä»¥å†…ã§ã®å®Œäº†
- [ ] ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®çµ±åˆ
- [ ] å¤±æ•—æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼é€šçŸ¥

## ğŸ—ï¸ æŠ€è¡“ä»•æ§˜
- **ä½¿ç”¨æŠ€è¡“**: GitHub Actions, pytest, flake8, black, mypy, bandit
- **ãƒˆãƒªã‚¬ãƒ¼**: push (main, develop), pull_request (main)
- **Pythonç‰ˆ**: 3.11.x (Streamlit Cloud Communityå¯¾å¿œ)

```yaml
# æƒ³å®šã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹é€ 
name: CI/CD Pipeline
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.11]
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
  
  quality:
    # ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ (Black, Flake8, mypy)
    
  security:
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ (Bandit, Safety)
```

## ğŸª æˆåŠŸåŸºæº–
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒæ­£å¸¸å‹•ä½œ
- [ ] å…¨å“è³ªãƒã‚§ãƒƒã‚¯é …ç›®ãŒPass
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- [ ] PRãƒãƒ¼ã‚¸å‰ã®è‡ªå‹•å“è³ªã‚²ãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] å¤±æ•—æ™‚ã®åˆ†ã‹ã‚Šã‚„ã™ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
### æ­£å¸¸ç³»
- [ ] æ­£å¸¸ãªã‚³ãƒ¼ãƒ‰ã§ã®CIå®Ÿè¡ŒæˆåŠŸç¢ºèª
- [ ] ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- [ ] ä¸¦åˆ—ã‚¸ãƒ§ãƒ–å®Ÿè¡Œã®ç¢ºèª
- [ ] ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç”Ÿæˆç¢ºèª

### ç•°å¸¸ç³»
- [ ] ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é©åˆ‡åœæ­¢
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œæ¤œå‡ºæ™‚ã®å‡¦ç†ç¢ºèª
- [ ] å“è³ªãƒã‚§ãƒƒã‚¯å¤±æ•—æ™‚ã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ
- [ ] ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã®ç¢ºèª

## ğŸ”— é–¢é€£Issue
- Part of Epic: #2 - CI/CDç’°å¢ƒã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ•´å‚™
- Blocks: ä»–ã®å…¨Feature Issues (CI/CDãŒå‰æ)

## ğŸ’¡ å®Ÿè£…ãƒ¡ãƒ¢
- CLAUDE.mdã®CI/CDè¨­å®šã‚’å‚è€ƒã«å®Ÿè£…
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹APIã‚­ãƒ¼ã¯mockå€¤ã§è¨­å®š
- Codecové€£æºã§ã‚«ãƒãƒ¬ãƒƒã‚¸å¯è¦–åŒ–

---
**Claude Code Actionä½¿ç”¨**: âœ… TDDã‚µã‚¤ã‚¯ãƒ«ã§ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Ÿè£…äºˆå®š
**æƒ³å®šå·¥æ•°**: 4-6æ™‚é–“
EOF
))
    
    echo "âœ… Created Issue: $ISSUE1"
    
    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æ§‹é€ æ§‹ç¯‰
    ISSUE2=$(gh issue create \
        --title "[FEAT] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æ§‹é€ æ§‹ç¯‰" \
        --assignee "@me" \
        --body-file <(cat << 'EOF'
## ğŸ¯ èƒŒæ™¯ãƒ»ç›®çš„
RAGã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’æ§‹ç¯‰ã—ã€Streamlit Cloud Communityå¯¾å¿œã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ•´å‚™ã™ã‚‹ã€‚

## ğŸ“‹ è¦ä»¶
### æ©Ÿèƒ½è¦ä»¶
- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã®é…ç½® (pyproject.toml, .env.exampleç­‰)
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ æ•´å‚™
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŸºç›¤æ§‹ç¯‰
- [ ] Streamlitè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

### éæ©Ÿèƒ½è¦ä»¶
- [ ] æ‹¡å¼µæ€§ã‚’è€ƒæ…®ã—ãŸæ§‹é€ è¨­è¨ˆ
- [ ] ãƒãƒ¼ãƒ é–‹ç™ºã«é©ã—ãŸæ•´ç†
- [ ] Streamlit Cloud Communityåˆ¶ç´„å¯¾å¿œ

## ğŸ—ï¸ æŠ€è¡“ä»•æ§˜
```
# æ§‹ç¯‰äºˆå®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
RAG-demo/
â”œâ”€â”€ streamlit_app.py              # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ pdf_uploader.py          # PDF ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ UI
â”‚   â”œâ”€â”€ chat_interface.py        # ãƒãƒ£ãƒƒãƒˆ UI
â”‚   â””â”€â”€ document_manager.py      # æ–‡æ›¸ç®¡ç† UI
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ pdf_processor.py         # PyMuPDF + spaCy å‡¦ç†
â”‚   â”œâ”€â”€ text_chunker.py          # æ„å‘³çš„ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²
â”‚   â”œâ”€â”€ vector_store.py          # Supabase Vectoræ“ä½œ
â”‚   â”œâ”€â”€ embeddings.py            # OpenAI Embeddings
â”‚   â””â”€â”€ claude_llm.py            # Claude APIçµ±åˆ
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py               # è¨­å®šç®¡ç†
â”‚   â””â”€â”€ error_handler.py        # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ document.py             # æ–‡æ›¸ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ chat.py                 # ãƒãƒ£ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py             # ãƒ†ã‚¹ãƒˆå…±é€šè¨­å®š
â”‚   â”œâ”€â”€ fixtures/               # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ unit/                   # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ integration/            # çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ .streamlit/
â”‚   â””â”€â”€ config.toml             # Streamlitè¨­å®š
â”œâ”€â”€ .env.example                # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ pyproject.toml              # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â””â”€â”€ pytest.ini                 # pytestè¨­å®š
```

## ğŸª æˆåŠŸåŸºæº–
- [ ] å®Œå…¨ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã®å‹•ä½œç¢ºèª
- [ ] streamlit run ã§ã®åŸºæœ¬èµ·å‹•ç¢ºèª
- [ ] é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰å®Œæˆ

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
### æ­£å¸¸ç³»
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®æ­£ç¢ºæ€§ç¢ºèª
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç¢ºèª
- [ ] åŸºæœ¬çš„ãªimportå‹•ä½œç¢ºèª
- [ ] Streamlitèµ·å‹•ç¢ºèª

### ç•°å¸¸ç³»
- [ ] ä¸æ­£ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
- [ ] ä¸è¶³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è‡ªå‹•ä½œæˆ
- [ ] æ¨©é™ã‚¨ãƒ©ãƒ¼å‡¦ç†

## ğŸ”— é–¢é€£Issue
- Part of Epic: #2 - CI/CDç’°å¢ƒã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ•´å‚™
- Depends on: None (æœ€åˆã«å®Ÿè£…)
- Blocks: ä¾å­˜é–¢ä¿‚è¨­å®šã€ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

---
**Claude Code Actionä½¿ç”¨**: âœ… ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Ÿè£…äºˆå®š
**æƒ³å®šå·¥æ•°**: 2-3æ™‚é–“
EOF
))
    
    echo "âœ… Created Issue: $ISSUE2"
    
    # ä¾å­˜é–¢ä¿‚ã¨ã‚³ãƒ¼ãƒ‰å“è³ªè¨­å®š
    ISSUE3=$(gh issue create \
        --title "[FEAT] ä¾å­˜é–¢ä¿‚ã¨ã‚³ãƒ¼ãƒ‰å“è³ªè¨­å®š" \
        --body-file <(cat << 'EOF'
## ğŸ¯ èƒŒæ™¯ãƒ»ç›®çš„
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚ç®¡ç†ã¨ã‚³ãƒ¼ãƒ‰å“è³ªä¿è¨¼ãƒ„ãƒ¼ãƒ«ã‚’è¨­å®šã—ã€ä¸€è²«ã—ãŸé–‹ç™ºæ¨™æº–ã‚’ç¢ºç«‹ã™ã‚‹ã€‚

## ğŸ“‹ è¦ä»¶
### æ©Ÿèƒ½è¦ä»¶
- [ ] requirements.txt (æœ¬ç•ªä¾å­˜é–¢ä¿‚)
- [ ] requirements-dev.txt (é–‹ç™ºä¾å­˜é–¢ä¿‚)
- [ ] pyproject.tomlè¨­å®š (å“è³ªãƒ„ãƒ¼ãƒ«è¨­å®šå«ã‚€)
- [ ] ã‚³ãƒ¼ãƒ‰å“è³ªãƒ„ãƒ¼ãƒ«è¨­å®š (Black, Flake8, mypy)
- [ ] Pre-commit hooksè¨­å®š

### éæ©Ÿèƒ½è¦ä»¶
- [ ] ä¾å­˜é–¢ä¿‚ã®æœ€å°åŒ–ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šã«ã‚ˆã‚‹å†ç¾æ€§ç¢ºä¿
- [ ] Streamlit Cloud Communityå¯¾å¿œ

## ğŸ—ï¸ æŠ€è¡“ä»•æ§˜
```python
# requirements.txt (ä¸»è¦ä¾å­˜é–¢ä¿‚)
streamlit>=1.28.0
langchain>=0.1.0
langchain-openai>=0.0.5
langchain-anthropic>=0.1.0
supabase>=2.0.0
pymupdf>=1.23.0
spacy>=3.7.0
openai>=1.0.0
anthropic>=0.8.0
python-dotenv>=1.0.0

# requirements-dev.txt (é–‹ç™ºä¾å­˜é–¢ä¿‚)  
pytest>=7.4.0
pytest-cov>=4.1.0
pytest-mock>=3.11.0
black>=23.7.0
flake8>=6.0.0
mypy>=1.5.0
bandit>=1.7.5
pre-commit>=3.3.0
```

## ğŸª æˆåŠŸåŸºæº–
- [ ] ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸ
- [ ] ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯å‹•ä½œç¢ºèª
- [ ] Pre-commit hooksæ­£å¸¸æ©Ÿèƒ½
- [ ] CI/CDçµ±åˆç¢ºèª

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
### æ­£å¸¸ç³»
- [ ] ä¾å­˜é–¢ä¿‚è§£æ±ºãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
- [ ] å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œç¢ºèª
- [ ] Pre-commitå‹•ä½œç¢ºèª
- [ ] å‹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œç¢ºèª

### ç•°å¸¸ç³»
- [ ] ä¾å­˜é–¢ä¿‚ç«¶åˆã‚¨ãƒ©ãƒ¼å‡¦ç†
- [ ] å“è³ªãƒã‚§ãƒƒã‚¯å¤±æ•—æ™‚ã®å¯¾å¿œ
- [ ] å¤ã„Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®è­¦å‘Š

## ğŸ”— é–¢é€£Issue
- Part of Epic: #2 - CI/CDç’°å¢ƒã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ•´å‚™
- Depends on: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æ§‹é€ æ§‹ç¯‰

---
**Claude Code Actionä½¿ç”¨**: âœ… ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Ÿè£…äºˆå®š
EOF
))
    
    echo "âœ… Created Issue: $ISSUE3"
    
    # æ®‹ã‚Šã®Feature Issuesã‚‚åŒæ§˜ã«ä½œæˆ...
    echo "ğŸ“ Epic #2 ã®Feature Issuesä½œæˆå®Œäº†"
    
elif [ "$EPIC_NUMBER" = "3" ]; then
    echo "ğŸ“‹ Creating RAG Implementation Epic Features..."
    # Epic #3ç”¨ã®Feature Issuesä½œæˆ
    echo "ğŸ“ Epic #3 ã®Feature Issuesä½œæˆã¯åˆ¥é€”å®Ÿè£…"
    
else
    echo "âš ï¸  Unknown Epic number: $EPIC_NUMBER"
    exit 1
fi

echo "ğŸ‰ Feature Issues creation completed for Epic #$EPIC_NUMBER"